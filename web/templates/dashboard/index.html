{% extends "base.html" %}
{% load staticfiles %}
{% block content %}

<div id="cuckoo-dashboard" class="hidden"></div>

<div class="flex-grid__horizontal--grow dashboard">
    <div class="flex-grid__column dashboard__left">
        <h2 class="dashboard__col-title">Insights</h2>

        <div class="dashboard-module" data-dashboard-module="installation">
            <header class="dashboard-module__header">
                <h4>Cuckoo Installation</h4>
            </header>
            <section class="dashboard-module__body">
                <table class="simple">
                    <tbody>
                        <tr>
                            <td>Version</td>
                            <td>{{ report.report_version }}</td>
                        </tr>
                        <tr class="up-to-date">
                          <td class="stretch" colspan="2"><em class="show-loaded">You are up to date.</em></td>
                        </tr>
                        <tr class="latest-version">
                            <td>Available</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <footer class="dashboard-module__footer">
                <p><i class="fa fa-exclamation-triangle"></i> A new version has been released. <a href="#">Update now</a></p>
            </footer>

        </div>

        <div class="dashboard-module">
            <header class="dashboard-module__header">
                <h4>Usage statistics</h4>
            </header>
            <section class="dashboard-module__body">
                <table class="simple">
                    <tbody data-populate="statistics">
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                     
                    </tbody>
                </table>
            </section>
            <!--
            <footer class="dashboard-module__footer">
                <p><i class="fa fa-info-circle"></i> How to: <a href="https://cuckoo.sh/docs/usage/utilities/#processing-utility" target="_blank">Manage Cuckoo processes</a></p>
            </footer>
            -->
        </div>

        <!-- blogpost -->
        <div class="dashboard-module" data-dashboard-module="blogposts">
          <header class="dashboard-module__header">
            <h4><i class="fa fa-newspaper-o icon-left"></i> From the press:</h4>
          </header>
          <section class="dashboard-module__body">

            <!--
              new approach for Handlebars: let's start writing handlebars code where it should be used in the template.
              steps forward :)
            -->
            {% verbatim %}
            <template id="blogpost-template">
              {{#if posts}}
                <ul class="content-list">
                  {{#each posts}}
                    <li>
                      <a href="{{url}}" title="Read '{{title}}' on cuckoosandbox.org" target="_blank">
                        {{#if important}}
                          <i class="fa fa-star"></i>
                        {{/if}}
                        {{title}}
                          <time>{{date}}</time>
                        {{#if oneline}}
                          <blockquote>&ldquo;{{oneline}}&rdquo;</blockquote>
                        {{/if}}
                      </a>
                    </li>
                  {{/each}}
                </ul>
              {{else}}
                <p class="dashboard-module__body--text">No blogposts have been loaded <small>(this indicates version_check has been disabled in cuckoo.conf)</small>.</p>
              {{/if}}
            </template>
            {% endverbatim %}

          </section>
          <footer class="dashboard-module__footer">
            <p><a href="https://www.cuckoosandbox.org/blog" target="_blank" title="Full list of our literature on cuckoosandbox.org">Click here for more</a></p>
          </footer>
        </div>

    </div>
    <div class="flex-grid__column dashboard__right">

        <h2 class="dashboard__col-title">Cuckoo</h2>

        <div class="dashboard-module__lg" data-dashboard-module="upload">
            <div class="dashboard-module__body omni-uploader">

                <div class="dashboard-module__body--left">

                    <div class="stack">
                        <div class="uploader-area" id="dashboard-submit"></div>
                        <div class="hidden csrf_placeholder" id="analysis_token">{% csrf_token %}</div>
                    </div>

                    <!-- <div class="stack">
                        <div class="uploader-area" id="dashboard-import"></div>
                        <div class="hidden csrf_placeholder" id="import_token">{% csrf_token %}</div>
                    </div> -->

                </div>

                <div class="dashboard-module__body--right">
                    <div id="submit-with-link">
                        <form>
                            <h5>Submit URLs/hashes</h5>
                            <textarea rows="6" class="form-control" placeholder="Submit URLs/hashes"></textarea>
                            <div class="text-center">
                                <button type="submit" class="button--lg">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>

            <div class="dashboard-module__footer">
                <p class="align-left"><i class="fa fa-info-circle"></i> Drag your file into the left field or click the icon to select a file.</p>
            </div>

        </div>

        <div class="dashboard-module" data-dashboard-module="system">
            <header class="dashboard-module__header">
                <h4 class="align-left clearfix">
                    System info
                    <div class="pull-right">
                        <span class="label label-free">free</span>
                        <span class="label label-used">used</span>
                        <span class="label label-total">total</span>
                    </div>
                </h4>
            </header>
            <section class="dashboard-module__body free-disk-space">

                <div class="dashboard-module__body--flex">
                    <h5>Free disk space</h5>
                    <div class="free-disk-space__chart" id="ds-stat">
                        <canvas></canvas>
                        <div class="free-disk-space__legend">
                            <p><strong data-populate={{ system_info.diskspace }}></strong></p>
                            <p data-populate={{ diskspace }}></p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-module__body--flex">
                    <h5>CPU Load</h5>
                    <div class="free-disk-space__chart" id="cpu-stat">
                        <canvas></canvas>
                        <div class="free-disk-space__legend">
                            <p><strong data-populate="cpu-load"></strong></p>
                            <p data-populate="total-cores"></p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-module__body--flex">
                    <h5>Memory usage</h5>
                    <div class="free-disk-space__chart" id="memory-stat">
                        <canvas></canvas>
                        <div class="free-disk-space__legend">
                            <p><strong data-populate="memory-used"></strong></p>
                            <p data-populate="memory-total"></p>
                        </div>
                    </div>
                </div>

            </section>
            <!--
            <footer class="dashboard-module__footer">
                <p><i class="fa fa-info-circle"></i> How to: <a href="https://cuckoo.sh/docs/installation/host/configuration/" target="_blank">Configure Cuckoo system options</a></p>
            </footer>
            -->
        </div>

    </div>

</div>

<div class="flex-grid__horizontal--grow dashboard bottom">

    <div class="flex-grid__column" id="dashboard-tables">

        <h2 class="dashboard__col-title">Recent analyses</h2>

        <!-- recent analyses -->
        <div class="dashboard-module__lg" data-dashboard-module="processes">
            <header class="dashboard-module__header">

                <div class="flex-tabs__tabs dashboard-module__tabs">

                    <!-- <a href="#" class="flex-tabs__tab active">Analyses</a>
                    <a href="#" class="flex-tabs__tab">Tasks</a>
                    <a href="#" class="flex-tabs__tab">Failed</a> -->

                    <div class="flex-tabs__tab--right">
                        <div class="custom-select" data-custom="select">
                            <span>Show: </span>
                            <select data-select="limit">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected="selected">3</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                    </div>

                </div>

            </header>
            {% if files %}
            <table class="table table-striped" style="table-layout: fixed;">
                <thead>
                <tr>
                    {% if config.expanded_dashboard %}
                      <th width="5%">ID</th>
                      <th width="10%">Timestamp</th>
                      <th width="15%">Filename</th>
                      <th width="15%">MD5</th>
                      <th width="5%">PKG</th>
                      {% if config.moloch %}
                      <th width="5%">Moloch</th>
                      {% endif %}
                      {% if config.display_office_martians %}
                      <th width="5%">Martians</th>
                      {% endif %}
                      {% if config.suricata %}
                      <th width="10%">Suricata Alerts/HTTP/TLS/Files</th>
                      {% endif %}
                      {% if config.virustotal %}
                      <th width="5%">VT</th>
                      {% endif %}
                      <th width="5%">MalScore</th>
                      <th width="10%">MalFamily</th>
                      <th width="5%">PCAP</th>
                      <th width="10%">ClamAV</th>
                      <th width="5%">Custom</th>
                      {% if config.display_shrike %}
                      <th width="5%">Shrike</th>
                      {% endif %}
                      <th width="5%" style="text-align: right;">Status</th>
                    {% else %}
                      <th width="5%">ID</th>
                      <th width="12%">Timestamp</th>
                      <th width="37%">Filename</th>
                      <th width="20%">MD5</th>
                      {% if config.moloch %}
                      <th width="5%">Moloch</th>
                      {% endif %}
                      {% if config.display_office_martians %}
                      <th width="5%">Martians</th>
                      {% endif %}
                      {% if config.suricata %}
                      <th width="7%">SuriAlert</th>
                      {% endif %}
                      {% if config.virustotal %}
                      <th width="5%">VT</th>
                      {% endif %}
                      <th width="5%">MalScore</th>
                      {% if config.display_shrike %}
                      <th width="5%">Shrike</th>
                      {% endif %}
                      <th width="6%" style="text-align: right;">Status</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                {% for analysis in files %}
                    <tr>
                        <td>
                            {{analysis.id}}
                        </td>
                        <td>
                        {% if analysis.status == "reported" %}
                            {{analysis.completed_on}}
                        {% else %}
                            <span class="muted">{{analysis.added_on}} (added on)</span>
                        {% endif %}
                        </td>
                        <td>
                        {{analysis.filename}}
                        </td>
                        <td style="word-wrap: break-word;">
                            {% if analysis.status == "reported" %}
                                <a href="{% url "report" analysis.id %}"><span class="mono">{{analysis.sample.md5}}</span></a>
                            {% elif analysis.status == "running" or analysis.status == "completed" %}
                                <a href="{% url "submission_status" analysis.id %}"><span class="mono">{{analysis.sample.md5}}</span></a>
                            {% else %}
                                <span class="mono">{{analysis.sample.md5}}</span>
                            {% endif %}
                        </td>
                        {% if config.expanded_dashboard %}
                        <td>
                            {% if analysis.package %}
                                  <span class="mono">{{analysis.package}}</span>
                            {% else %}
                                  <span class="mono">None</span>
                            {% endif %}
                        </td>
                        {% endif %}
                        {% if config.moloch %}
                        <td>
                            {% if analysis.moloch_url %}
                                <a href={{analysis.moloch_url}} target="_blank"><span class="mono">MOLOCH</span></a>
                            {% else %}
                                  <span class="mono">None</span>
                            {% endif %}
                        </td>
                        {% endif %}
                        {% if config.display_office_martians %}
                        <td>
                            <span class="mono">
                            {% if analysis.f_mlist_cnt %}
                            {{analysis.f_mlist_cnt}}
                            {% else %}
                            None
                            {% endif %}
                            </span>
                        </td>
                        {% endif %}
                        {% if config.suricata %}
                        <td>
                            <span class="mono">
                            {% if analysis.suri_alert_cnt %}
                            <a href="{% url "surialert" analysis.id %}" target="_blank">{{analysis.suri_alert_cnt}}</a><!--
                            {% else %}
                            0<!--
                            {% endif %}
                            {% if config.expanded_dashboard %}
                                {% if analysis.suri_http_cnt %}
                                -->/<a href="{% url "surihttp" analysis.id %}" target="_blank">{{analysis.suri_http_cnt}}</a><!--
                                {% else %}
                                -->/0<!--
                                {% endif %}
                                {% if analysis.suri_tls_cnt %}
                                -->/<a href="{% url "suritls" analysis.id %}" target="_blank">{{analysis.suri_tls_cnt}}</a><!--
                                {% else %}
                                -->/0<!--
                                {% endif %}
                                {% if analysis.suri_file_cnt %}
                                -->/<a href="{% url "surifiles" analysis.id %}" target="_blank">{{analysis.suri_file_cnt}}</a><!--
                                {% else %}
                                -->/0<!--
                                {% endif %}
                            {% endif %}
                            --></span>
                        </td>
                        {% endif %}
                        {% if config.virustotal %}
                        <td>
                            {% if analysis.virustotal_summary %}
                                <a href="{% url "antivirus" analysis.id %}" target="_blank"><span class="mono">{{analysis.virustotal_summary}}</span></a>
                            {% else %}
                                  <span class="mono">None</span>
                            {% endif %}
                        </td>
                        {% endif %}
                        <td>
                            {% if analysis.malscore != None %}
                                <span 
                                {% if analysis.malscore <= 2.0 %}
                                class="label label-success"
                                {% elif analysis.malscore <= 6.0 %}
                                class="label label-warning"
                                {% else %}
                                class="label label-danger"
                                {% endif %}
                                {% if analysis.malfamily %}
                                title="{{analysis.malfamily}}"
                                {% endif %}
                                >{{analysis.malscore|floatformat:1}}</span>
                            {% else %}
                                <span class="mono">None</span>
                            {% endif %}
                        </td>
                        {% if config.expanded_dashboard %}
                        <td>
                            <span class="mono">
                                {% if analysis.malfamily %}
                                {{analysis.malfamily}}
                                {% else %}
                                None
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="mono">
                            {% if analysis.pcap_sha256 %}
                            <a href="{% url "file" "pcap" analysis.id analysis.pcap_sha256 %}" target="_blank">PCAP</a>
                            {% else %}
                            None
                            {% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="mono">
                            {% if analysis.clamav %}
                                {{analysis.clamav}}
                            {% else %}
                                None
                            {% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="mono">
                            {% if analysis.custom %}
                                {{analysis.custom}}
                            {% else %}
                                None
                            {% endif %}
                            </span>
                        </td>
                        {% endif %}
                        {% if config.display_shrike %}
                        <td>
                            {% if analysis.shrike_msg %}
                                 {% if analysis.status == "reported" %}
                                     <a href="{% url "shrike" analysis.id %}" target="_blank"><span class="mono">{{analysis.shrike_msg}}</span></a>
                                 {% else %}
                                     <span class="mono">{{analysis.shrike_msg}}</span>
                                 {% endif %}
                            {% else %}
                                 <span class="mono">None</span>
                            {% endif %}
                        </td>
                       {% endif %}
                        <td style="text-align: right;">
                            {% if analysis.status == "pending" %}
                                <span class="text-muted">pending</span>
                            {% elif analysis.status == "running" %}
                                <span class="text-warning">running</span>
                            {% elif analysis.status == "completed" %}
                                <span class="text-info">processing</span>
                            {% elif analysis.status == "reported" %}
                                {% if analysis.errors %}
                                    <span class="text-danger">
                                {% else %}
                                    <span class="text-success">
                                {% endif%}

                                reported</span>
                            {% else %}
                                <span class="text-danger">{{analysis.status}}</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="panel-body">No files to display on this page.</div>
            {% endif %}
        </div>

                <!--
                <div class="dashboard-module__body--right" data-populate="dashboard-table-pending">
                <div class="hidden csrf_placeholder" id="analysis_token">{% csrf_token %}</div>
                </div>
                -->
            </section>

            <footer class="dashboard-module__footer">
                <p><a href="/analysis/">Show all recent analyses</a></p>
            </footer>

        </div>

    </div>

</div>

{% endblock %}

